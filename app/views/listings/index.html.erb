<div class="container">
  <div class="row">
    <div class="col-sm-4">
      <h1 class="text-center info-pane-title">public<span class="ad-txt">ad</span></h1>
      <div class="info-pane-description">
        <p>Click on one of the map's markers to get started and see the public<span class="ad-txt">ad</span> information.</p>
      </div>
      <hr>
<div class="row">
<div class="col-xs-12">
<%=form_tag("/listings", method: "get", search: true, class: "nifty_form", id: "search_form") do%>
<div class="row">
<div class="col-xs-12">
<%= label_tag(:category, "Search by publicAd space type: ", class: 'home-search-label') %>
<%=select_tag "category", "<option selected='selected'>All</option><option>Billboard</option><option>Bench Ad</option><option>Bus Stop Ad</option>".html_safe%>
</div>
<div class="col-xs-12">
<%= label_tag(:address, "Address:") %>
<%= text_field_tag(:address, nil, :required => true) %>
</div>

<%= hidden_field_tag('distance', 'valuye')%> 



<!-- <%= text_field_tag(:search) %> -->
</div>
<div class="row">
        <div id="nonlinear"></div>
      <span class="example-val" id="lower-value"></span>
      <span id="lower-offset"></span>
      <span class="example-val" id="upper-value"></span>
      <span id="upper-offset"></span>
</div>
<div class="row">
<div class="col-xs-12">
<%= submit_tag("Find", class: 'btn btn-warning', id: 'distance_slider') %>
</div>
</div>
<div class="row">
  <!-- <div id="sliderFly"></div> -->
<div class="col-xs-10">

<div class="view center-block">

</div>
</div>




</div>
<%end%>
</div>
</div>  
<hr>
      <div class="side-bar-container">
        <ul id="marker_list">
          
        </ul>
      </div>
      <hr>

    </div>
    <div class="col-sm-8">
      <div id='pubAdMap'></div>
    </div>
  </div>
</div>

<% content_for :javascripts do %>
<script type="text/javascript" src="http://maps.google.com/maps/api/js"></script>
<script type="text/javascript">
var APP = {};
var map,
    center,
    mapContainer = $('#pubAdMap'),
    mapCanvas = document.createElement('div'),
    infoWindows = [];
    var mapOptions = {
      center: new google.maps.LatLng(37.7851138,-122.4204182),
      zoom: 13,
      mapTypeId: google.maps.MapTypeId.ROADMAP,
      zoomControl: true, 
      mapTypeControl: false,
      scrollwheel: false,
      zoomControlOptions: {position: google.maps.ControlPosition.LEFT_CENTER},
      styles: [{"featureType":"landscape","stylers":[{"saturation":-100},{"lightness":60}]},{"featureType":"road.local","stylers":[{"saturation":-100},{"lightness":40},{"visibility":"on"}]},{"featureType":"transit","stylers":[{"saturation":-100},{"visibility":"simplified"}]},{"featureType":"administrative.province","stylers":[{"visibility":"off"}]},{"featureType":"water","stylers":[{"visibility":"on"},{"lightness":30}]},{"featureType":"road.highway","elementType":"geometry.fill","stylers":[{"color":"#ef8c25"},{"lightness":40}]},{"featureType":"road.highway","elementType":"geometry.stroke","stylers":[{"visibility":"off"}]},{"featureType":"poi.park","elementType":"geometry.fill","stylers":[{"color":"#b6c54c"},{"lightness":40},{"saturation":-40}]},{}]
    };

;APP.locationsMap = function () {
  function initialize() {
    console.log(gon.sampleData);
    styleMapElement(mapCanvas);
    appendMapElement(mapCanvas, mapContainer);
    APP.map = new google.maps.Map(document.getElementById("map"),
        mapOptions);    
    setMarkers(APP.map, gon.sampleData);
    function styleMapElement(mapCanvas){
      mapCanvas.id = 'map';
      mapCanvas.style.height = '440px';
      mapCanvas.style.width = '100%';
      mapCanvas.style.margin='0 auto 0';
      mapCanvas.style.position= 'relative';
      return mapCanvas;
    }
    function appendMapElement(mapCanvas, mapContainer){
      var mapContainingElement;
      $(mapContainer).append(mapCanvas);
    }
    function calculateCenterOfMap() {
      APP.mapCenter = APP.map.getCenter();
    }
    function setMarkers(map,locations){
    var marker, i;
    console.log('locations' + locations)
      for (i = 0; i < locations.length; i++) {  
        var name = locations[i][1]['title'];
        var lat = locations[i][0]['latitude'];
        var longi = locations[i][0]['longitude'];
        var baseUrl = '/listings/'
        var latlngset = new google.maps.LatLng(lat, longi);
        var icon = {
                  scaledSize: new google.maps.Size(32, 32), 
                  origin: new google.maps.Point(0,0), 
                  anchor: new google.maps.Point(0, 0)
                };
        if (locations[i][1]['is_available'] === true) {
                icon['url']= "map_marker.png";
        }
        if (locations[i][1]['is_available'] === false) {
                  icon['url']= "map_marker_n.png" ;
        }
        marker = new google.maps.Marker({  
                  map: map, 
                  title: name,
                  position: latlngset,
                  icon: icon
                });

        var content = "<p class='marker_title'>"+name+"</p><p class='marker_title'><a href='"+baseUrl+locations[i][1]['id']+"'>More Info</a></p>";
        var infowindow = new google.maps.InfoWindow();
            createMarkerButton(marker);
        google.maps.event.addListener(marker,'click', (function(marker,content,infowindow){ 
            return function() {
                /* close the previous info-window */
               closeInfoWindows();
                   infowindow.setContent(content);
                   infowindow.open(map,marker);
                /* keep the handle, in order to close it on next click event */
                infoWindows[0]=infowindow;
            };
        })(marker,content,infowindow)); 
      }
    }
    function closeInfoWindows(){
       if(infoWindows.length > 0) {
          /* detach the info-window from the marker ... undocumented in the API docs */
          infoWindows[0].set("marker", null);
          /* and close it */
          infoWindows[0].close();
          /* blank the array */
          infoWindows.length = 0;
       }
    }
    function createMarkerButton(marker) {
  //Creates a sidebar button
      var ul = document.getElementById("marker_list");
      var li = document.createElement("li");
      var title = marker.getTitle();
      li.innerHTML = title;
      ul.appendChild(li);
      
      //Trigger a click event to marker when the button is clicked.
      google.maps.event.addDomListener(li, "click", function(){
        google.maps.event.trigger(marker, "click");
      });
    }

    google.maps.event.addDomListener(APP.map, 'idle', function() {
      calculateCenterOfMap();
    });
    google.maps.event.addDomListener(window, 'resize', function() {
      APP.map.setCenter(APP.mapCenter);
    });
  }
  google.maps.event.addDomListener(window, 'load', initialize);
}
</script>
<script>APP.locationsMap();</script>



<% end %>